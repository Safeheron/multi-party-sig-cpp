#include <google/protobuf/stubs/common.h>
#include "gtest/gtest.h"
#include "multi-party-sig/two-party-ecdsa/lindell17/P1KeyShare.h"
#include "multi-party-sig/two-party-ecdsa/lindell17/P2KeyShare.h"
#include "multi-party-sig/two-party-ecdsa/lindell17/sign/P1Context.h"
#include "multi-party-sig/two-party-ecdsa/lindell17/sign/P2Context.h"
#include "multi-party-sig/two-party-ecdsa/lindell17/sign/message.h"
#include "crypto-suites/crypto-hash/sha256.h"
#include "crypto-suites/crypto-encode/hex.h"

using safeheron::two_party_ecdsa::lindell17::sign::P1Context;
using safeheron::two_party_ecdsa::lindell17::sign::P2Context;

using safeheron::two_party_ecdsa::lindell17::sign::P1Message0;
using safeheron::two_party_ecdsa::lindell17::sign::P1Message1;
using safeheron::two_party_ecdsa::lindell17::sign::P1Message2;
using safeheron::two_party_ecdsa::lindell17::sign::P2Message0;
using safeheron::two_party_ecdsa::lindell17::sign::P2Message1;
using safeheron::two_party_ecdsa::lindell17::sign::P2Message2;

using safeheron::two_party_ecdsa::lindell17::P1KeyShare;
using safeheron::two_party_ecdsa::lindell17::P2KeyShare;

TEST(lindell17, sign) {
    std::string str = "hello!";
    safeheron::hash::CSHA256 sha256;
    uint8_t digest[safeheron::hash::CSHA256::OUTPUT_SIZE];
    sha256.Write(reinterpret_cast<const unsigned char *>(str.c_str()), str.size());
    sha256.Finalize(digest);
    safeheron::bignum::BN m = safeheron::bignum::BN::FromBytesBE(digest, safeheron::hash::CSHA256::OUTPUT_SIZE);

    std::string key_share1_b64 = "CkBFNTE1QkU0RTdDMjU3RUQ2MTM1MjdENDIxQUM5QzRFNEZGNzY4MjFBRDAwNUE1NDA5RTczRjY2QzkxMjU4OEQxEo8BCkA0QkMxODY4QTZFOTUzMUVGODE5OURDNTk3NEFEN0IwQ0QzMUEwNzIyOUJCNUEyNTc5RTFEMkQ0QkZCNTIwQ0VFEkAwQTA2Njg5OEVBMDkwMDUyMjQwNDRDNDlBQUYyNDAzODBEQUVCQjU4QjI5NDlGODRDOTIzOUEyMjlEMzBBOEQ5GglzZWNwMjU2azEapyQKgARCQjhFMzc0QThGMTc5NzNFMTMxNTNDQTA1MEEwN0FFNzg2QTUyODA4MEVGMkNCMEU1MDdGRDkxRDFDRDM0MDQxOUYwRkMyREExNTQ0OTIxODM3NDIwRTU0QzEwMDU0QzIwREQ0NUJGQ0NERDA5NERBQzg5QkM1QUFGN0Y4RUVEMkQyOEMwODJEMjQ4QTQ4N0E4MjA0NjUzOEQ4MUFGQ0ZGRUVERTI1NjJCMUYwREE1N0JDODUyMTUyMzczQzEzM0IxOTZEMThFOThGM0Q2RkM5M0U0RUMxNERCQzI3NENCMEZDQTE0RTBCN0Q4RDMwQjNBNzk2MTFCMzE4RDBEQzAzREY5QjUxRkZCMjM3RDdFRjhFNkUyRTQ1OTgyMkY1REVGQjYyODcwMzA4MjRFMjU5MEFENkZCQTRCREU3NDJEMzQyQkQyRkRGMTMyNTk4MTc3RTk1MTI5MkM0RDIyOUQ5N0I5Njk3MzU2RDAzNkUwNTI3RDM2MTk1NURDN0Y0RTZDODU3RkJEOTNCRjQwQ0NEOTE3Qzk2RkM0NzZGOEZFQ0RCQTc1OThBNEE0REZGRUI2QkVCNTU0OUE4REZBRjA0NDg0RUU5MTcyNkE3QzlFNkEwNjA4QTM5QTA5Q0E4NTM2M0NBQTQzRDE4MjBGM0I2QjNEQzUxMDg0MjQ2QThCMRKABEJCOEUzNzRBOEYxNzk3M0UxMzE1M0NBMDUwQTA3QUU3ODZBNTI4MDgwRUYyQ0IwRTUwN0ZEOTFEMUNEMzQwNDE5RjBGQzJEQTE1NDQ5MjE4Mzc0MjBFNTRDMTAwNTRDMjBERDQ1QkZDQ0REMDk0REFDODlCQzVBQUY3RjhFRUQyRDI4QzA4MkQyNDhBNDg3QTgyMDQ2NTM4RDgxQUZDRkZFRURFMjU2MkIxRjBEQTU3QkM4NTIxNTIzNzNDMTMzQjE5NkQxOEU5OEYzRDZGQzkzRTRFQzE0REJDMjc0Q0IwRkNBMTRFMEI3RDhEMzBCM0E3OTYxMUIzMThEMERDMDIyN0ExQzRBRjhBNEFBRUY3RDlCRkYwQzZENTJDRTA2REJBQTQyNUNDMDM2ODU5MjdCMDc5QjI1NTc0MUUyMzIzQjQ0QUNBMDVERTdEOTg1Mjc1NjdFRTgzN0QxNDM5NDhCRUFEMDNFQ0Q0OENDNUNBODA3MzZBMkQwNzdGQjIxOTAwMEYzMUNDQUM4MkI0NENCRDYwMDkxODQwMEVGNUUwRDg3MkQ2MDFBNTlBOTA2MzQwNzFGQkIwNjUwNkNGN0FGNjc2Q0FCRTVDNDQwQ0RDQURBQThCOTVFNzkzNjQzRjg5MDg5QTBGMzMzQTdBNzM5MkE5MTYyMzVGMTY2OEY0GoAENEQ0QzAzMzM2NUNGNDc1NTY1OTdCRUI2OEQxOUYwOTE2Qjk5MUNGNUI0RjY1MDI0QjNERUUwNEQwM0Y3OThDMDkwMDVGODgwNzYxQTg0MUUyMUU0OUU5NDJDMzNEOUIxOEU2NkZFMDA2MjQxNEExRjlBOTVDQTUyQkY3QjVFRDFGMTU0QjEzM0Y4NjBCQzE4N0FFQjZDQjQ1ODM4NTc0QTJFOENENEU2OTk3NEUwODVGODBDOUFFMDY0MzQ2Q0RGRjJCRTM5QUE4NzU0NzI2NDJFMzJFNzNERjRGNDU2NURFNjFENTc1MEIzQzY5ODE0OTVFMTNERTU3MEY5OTlBQTdCNDJEMDYxQUUzQTU1MThFRjM1NkZENTJDRjhDMjExMDE2NkVERThCMERCRjE4RTI0OUE5RUJCQTdDMDY5Q0FEQjdBRjRCMDI2OEU0QjAyNzk5M0I2NEZGMzY5RkYxRkM3Mjc4NURGQzE0NTE5NkQ2N0M5NTY4MTgxQzNEQzM0N0FFRDIyMkEyMzNEQjg2NDlCRDM0MTUwMjQyMTUyQkNFMDMzMDgyRjIwQ0QxMkNCMDhCQUU2NjRDN0FGMjkyRTRDMTc4QzZBQUU5OENDM0E5MTcwODU0OEQ4MkMxMzU0QkZCMEZCODhERjE3QUZENTJDNUFCOTEwNzIzOTI2MEIigAJFRjdDQkFDNzBBOUExNkU3NkRFQjE3NkJERTBFQTBBNEYwMDYzNUVEOUY4MTU0MTA1QTEwNkNERTM2NzQwQUU0QTU1REQ2RTA2QTNCNEZGQUNBMzhBRjEyQTVDOTMxQjcyQTc2NkEzNjJGOTQ3M0RBRDExMjU1M0RBREQ5RjNGMEE4QjRBOEFFOTZFOUQ5MzAxMEI0QkUzMzVEQzQ1MUYwOEQ3RUNCOUEzNjM0Nzc5QTVERkJEMUE5QzhBNEYyMzdCQjc5NUQ4Mjc3MEQzMUJDMDMwMDQ3REVFNjkwNkJCOTg5MzhCNUJDNEE0ODI5QTlCRDBGRjJEOTQzNjA3RjhCKoACQzg3Q0QyODkxRDUzMTIxMDQ2QzMyNjEyRTRFNzc0Q0M1MEI4MkI0OTY1M0IzNTIxMDA0Q0RDNzExMzU1MTRDQUU5MTQ4RUY4Q0E2Q0FGQ0EzRUY0NzRGQ0ExRjRCRUQ5OTI3MzI5MTI2OEUyMzQ1RkQ2NERBMjJBQTg2RTRFREQxRjk0MjE1REY4ODc3RjUwQzM2N0NGQjBBOTlDNDgxQjc1QjVCN0VFNkU3RUY3RURDRDdEODdFRjdCMzNFRDUxOTY1RUMwRDY1MzU2OEI0REVGQjVCNkM0RDI3OEQ4NUE1MTg5NTQ3MTlBOUU0Rjk5NjQyMzQ4MEI5RkNGQzAzMzKABEUwMEEyMTg1MUVFM0QyMzNCNEI3QkY4QTNGQjhDQjQ4QTRCRUIyQkQ2Njg1NUQxMEY0RjlDREFGRUI1ODFCNzE3RjcxRUE4MEREMkI4MTFBRTY0NkQ1MUZBMjEyNzBGMEQwQUM1Q0Y2NkRDNEJCMDI0NDk2RDg3Qzk5MTRGNjc4Nzc3ODlFNTBFQzNGOTdCN0NBOTAyRUQ5OURCMzdBNTdDQjkxQkMwNDA4MDZGMUFGNjhDNEYyMzEyNTgwNjUwNkExNjVEQjQ4OThCQjI1OERFMzZEOTc1MTZDQkUxMzU2REFFRjNBN0RFMDNCRjhDQjA5ODU5RjFCMDQwMTZCRTZEODJDQTJDQ0JCOUNFNkZGNjE1MUM1QTNGRERDOTQ1MDZGM0VDQjUyNTQyNDkxMTZFNDg2RDRBMUM2RTk2MUEzNDc4RjE3MUM5QzkyODQ1RTQ1REQ5MUNFRkY2MEVFQTE5QUNFMjdBN0Q5MEE5RjRCMDUwOEQ0NUUxQ0MwQ0RDOTc0RkU2NkY3QjhGQ0IyNUNERUFGMEEzNDg3NzBFMDlBOTE2NkZEMUMwM0UzRkFDQ0M4M0RDNzBGRjNBMTMyM0Q0NDlBQzRDMTA1NTE3RUI0RjRCQUU5MjFFQTA0OTQ3QTc4ODg1QTJGMjFDNEM4RURFQ0MwQUNDOEE5Q0IzNTc5OoAEOUQwMzQ1RDJERkNCNzIzRjlFM0Q2RjFBQjcyOThBQTQ3NEQzQzNEN0I1MkJBMkY2OTNFQTBDQ0Q5OUJDMDJFQzJEQzE2MUJFOTU5OEU0NzIyN0E5MDM5NUE2RUZEM0M1ODk2QkY2QjZCRjFDNTcxNURCMERGQzc3MzdCRkFCQjVCOEQxNzJFODI1MEZCM0U2MkRFOTc4REIzNDYxRjM1MjJDNUQ1MjY5OUM2ODI0QTI4NEY1QTM4QjA4RkJDNUJGNjExRDE0Mjk4ODBGMEE3ODZFNEMyQTQ5M0E3Mjg0OTM5OTREQTFFMUYxNjhGOTE2MDU1OTZGM0EwRkRCMEE5OUVEOTQyODI4MDdFNzAxOUZDNDZERUJEQkY5QTk0N0U2OTI4QjVCREU4RUIwMjU2MkEwNzNDMDBGODE0RTIxOTE1Mzg4QUEyMDQ2N0Q0MkJDRTNGNDc2QTdGREQ1MDhDQUU5RDJERDEyNDJDOUEzQzExRDQzMEYzQTU4QkFEMkFFQjFCOEMxOEI4MTg4QTJDMEUwQzk2QkUxNEQzMDJEMjg2RThDNkZEM0JGQjI3N0U1OTRGREMxNDU3RjJFQkJCM0M0QTk0RTlBOEU0NkJFMjlCMUVCMEMzMUJBQ0IwOEVDRjI4RDNDNjFCNjM1QzI1ODYxQUNFREI5QkNDNjhBMjlCgAJFRjdDQkFDNzBBOUExNkU3NkRFQjE3NkJERTBFQTBBNEYwMDYzNUVEOUY4MTU0MTA1QTEwNkNERTM2NzQwQUU0QTU1REQ2RTA2QTNCNEZGQUNBMzhBRjEyQTVDOTMxQjcyQTc2NkEzNjJGOTQ3M0RBRDExMjU1M0RBREQ5RjNGMEE4QjRBOEFFOTZFOUQ5MzAxMEI0QkUzMzVEQzQ1MUYwOEQ3RUNCOUEzNjM0Nzc5QTVERkJEMUE5QzhBNEYyMzdCQjc5NUQ4Mjc3MEQzMUJDMDMwMDQ3REVFNjkwNkJCOTg5MzhCNUJDNEE0ODI5QTlCRDBGRjJEOTQzNjA3RjhBSoACQzg3Q0QyODkxRDUzMTIxMDQ2QzMyNjEyRTRFNzc0Q0M1MEI4MkI0OTY1M0IzNTIxMDA0Q0RDNzExMzU1MTRDQUU5MTQ4RUY4Q0E2Q0FGQ0EzRUY0NzRGQ0ExRjRCRUQ5OTI3MzI5MTI2OEUyMzQ1RkQ2NERBMjJBQTg2RTRFREQxRjk0MjE1REY4ODc3RjUwQzM2N0NGQjBBOTlDNDgxQjc1QjVCN0VFNkU3RUY3RURDRDdEODdFRjdCMzNFRDUxOTY1RUMwRDY1MzU2OEI0REVGQjVCNkM0RDI3OEQ4NUE1MTg5NTQ3MTlBOUU0Rjk5NjQyMzQ4MEI5RkNGQzAzMlKAAkQ2NDg3OUFBMjdGNjczMkJEMTYyODI1NjBCMDc5QjI2RUZBMDNBMjBBRDk3MTQ2MkVCQjQ2QzQwRkIwMDE4NTY2ODdERTI1QTREMDI5MzM3Njg2NEI5RTVBREMzNTMxODlDRUYwNjU2RDlCRUQ3OTM2Q0U1OTBFQjJEQzEyRDU3OURGNTJBQUFCRUY5NjQ0NkIyRjM0RTA3MEY5MzY5Q0YwMTM5NTA3REFBQjcyNEI1MUUzQzIwQTAzQTVCMzY0NDEwRjY2NTdBQjdBQzQ3M0RFRjM4RjMyMzgxMjJDQ0IwQTg1RTY1NEQ3NEIxRjJENTQzM0NGRUVFMDdFODg1MzJagAIxNTE5ODcxRjIyQTUxNjQ0Mjg0M0IxQzRBRUEwMDlFNTcxNjJDMTE1RjMyQTA5QjE1REVFNTBCNDRDOEVCRjdFQTIzOEUyMERFN0EzRDFGNDk0N0MyMEFBOEE5M0I4RTVCNjZCM0E1QUNDQTFBQzk4QzRBMEQ4NzdFNTEzNDk4RDA0MzdBRDVEOUE2NjVCOTdCRTVFRUYxRTc1MDVEOUY3NURCREFGM0NDNTE2Q0ZBNzgxOUExMUZBNjA3OTc5OTg4NzU0MjAzMzYzM0NBQUVGQ0VFMzdGNDU4QkI0OThCRUYxQjUzMzlCQUY5MTk5OEI4QjEzNTk2OTUyMTdCNjZFYoACMTkzNDQxMUNFMkEzQTNCQjlDODg5NTE1RDMwNzA1N0UwMDY1RkJDQ0YxRUEzRkFENkU1QzAwOUQzQjczRjI4RTNDREZGNDg2MUQzOEJDQzM2MUQzRjUyQ0Y4MDVERTlFOEQ4NzYzREY1NUQ1OUM0NzY0MkNDNDUyODAxOEM2OTkwQUJGN0UwM0Q3RjA3NEU5NURDMTcwMkM0RTMwRTgyMThDNDU3QjFDOEI3RDUyRTUzRkJGQjEwOThFNDlCQkYzQUE4MkY4MDdCRjYwRUE3RTEzQzc1NEJCNjU2RDlGMDhFMERBNTA2RUQ1OTYzNkQ0NzlEMkYzRUIzQjc3RkE1OWqAAkIzNjM0QjY5RkFBREZCQ0MxRTdGNzQ0RTM2NDc2QUU2REY1NTZBMzM3MjExMkI2RkEyNUU4QkJDQzZDNjU1NEM0NkRCQUNFQUUyQzhEREQ1QUE3ODU0NTIxNzYxMDVGM0RDMDdFRUI3OUM0MDg3QzcxMUFDQzlCMkMzNUIwNTUwMUI1Qzc0MDA1RTIxMjNCOTA1MDhFMDkyMzQ5NjZFMjQxN0Y4MDhCMUE5NjgyODQ2NEJFMzc1RjUxQUJBNzNCOTBGMEFBMEEyRjAxOUUwNUUyMEQyMzc3RjQ2QzQzRjlCNUZENDIwRDVFQjBDQjYwREQ5MEZFRUEyNERCODA5QzUihggKgARCQjhFMzc0QThGMTc5NzNFMTMxNTNDQTA1MEEwN0FFNzg2QTUyODA4MEVGMkNCMEU1MDdGRDkxRDFDRDM0MDQxOUYwRkMyREExNTQ0OTIxODM3NDIwRTU0QzEwMDU0QzIwREQ0NUJGQ0NERDA5NERBQzg5QkM1QUFGN0Y4RUVEMkQyOEMwODJEMjQ4QTQ4N0E4MjA0NjUzOEQ4MUFGQ0ZGRUVERTI1NjJCMUYwREE1N0JDODUyMTUyMzczQzEzM0IxOTZEMThFOThGM0Q2RkM5M0U0RUMxNERCQzI3NENCMEZDQTE0RTBCN0Q4RDMwQjNBNzk2MTFCMzE4RDBEQzAzREY5QjUxRkZCMjM3RDdFRjhFNkUyRTQ1OTgyMkY1REVGQjYyODcwMzA4MjRFMjU5MEFENkZCQTRCREU3NDJEMzQyQkQyRkRGMTMyNTk4MTc3RTk1MTI5MkM0RDIyOUQ5N0I5Njk3MzU2RDAzNkUwNTI3RDM2MTk1NURDN0Y0RTZDODU3RkJEOTNCRjQwQ0NEOTE3Qzk2RkM0NzZGOEZFQ0RCQTc1OThBNEE0REZGRUI2QkVCNTU0OUE4REZBRjA0NDg0RUU5MTcyNkE3QzlFNkEwNjA4QTM5QTA5Q0E4NTM2M0NBQTQzRDE4MjBGM0I2QjNEQzUxMDg0MjQ2QThCMRKABEJCOEUzNzRBOEYxNzk3M0UxMzE1M0NBMDUwQTA3QUU3ODZBNTI4MDgwRUYyQ0IwRTUwN0ZEOTFEMUNEMzQwNDE5RjBGQzJEQTE1NDQ5MjE4Mzc0MjBFNTRDMTAwNTRDMjBERDQ1QkZDQ0REMDk0REFDODlCQzVBQUY3RjhFRUQyRDI4QzA4MkQyNDhBNDg3QTgyMDQ2NTM4RDgxQUZDRkZFRURFMjU2MkIxRjBEQTU3QkM4NTIxNTIzNzNDMTMzQjE5NkQxOEU5OEYzRDZGQzkzRTRFQzE0REJDMjc0Q0IwRkNBMTRFMEI3RDhEMzBCM0E3OTYxMUIzMThEMERDMDNERjlCNTFGRkIyMzdEN0VGOEU2RTJFNDU5ODIyRjVERUZCNjI4NzAzMDgyNEUyNTkwQUQ2RkJBNEJERTc0MkQzNDJCRDJGREYxMzI1OTgxNzdFOTUxMjkyQzREMjI5RDk3Qjk2OTczNTZEMDM2RTA1MjdEMzYxOTU1REM3RjRFNkM4NTdGQkQ5M0JGNDBDQ0Q5MTdDOTZGQzQ3NkY4RkVDREJBNzU5OEE0QTRERkZFQjZCRUI1NTQ5QThERkFGMDQ0ODRFRTkxNzI2QTdDOUU2QTA2MDhBMzlBMDlDQTg1MzYzQ0FBNDNEMTgyMEYzQjZCM0RDNTEwODQyNDZBOEIy";
    std::string key_share2_b64 = "CkA4Mjk1OUVCQjZCNEVCRjlCMjJDMjMwNThGNDUxQjJENkQ1QzA4MDVFN0VEMEI4MTBEQTZFQUFGMDVGODlBRUVCEo8BCkA0QkMxODY4QTZFOTUzMUVGODE5OURDNTk3NEFEN0IwQ0QzMUEwNzIyOUJCNUEyNTc5RTFEMkQ0QkZCNTIwQ0VFEkAwQTA2Njg5OEVBMDkwMDUyMjQwNDRDNDlBQUYyNDAzODBEQUVCQjU4QjI5NDlGODRDOTIzOUEyMjlEMzBBOEQ5GglzZWNwMjU2azEahggKgARCQjhFMzc0QThGMTc5NzNFMTMxNTNDQTA1MEEwN0FFNzg2QTUyODA4MEVGMkNCMEU1MDdGRDkxRDFDRDM0MDQxOUYwRkMyREExNTQ0OTIxODM3NDIwRTU0QzEwMDU0QzIwREQ0NUJGQ0NERDA5NERBQzg5QkM1QUFGN0Y4RUVEMkQyOEMwODJEMjQ4QTQ4N0E4MjA0NjUzOEQ4MUFGQ0ZGRUVERTI1NjJCMUYwREE1N0JDODUyMTUyMzczQzEzM0IxOTZEMThFOThGM0Q2RkM5M0U0RUMxNERCQzI3NENCMEZDQTE0RTBCN0Q4RDMwQjNBNzk2MTFCMzE4RDBEQzAzREY5QjUxRkZCMjM3RDdFRjhFNkUyRTQ1OTgyMkY1REVGQjYyODcwMzA4MjRFMjU5MEFENkZCQTRCREU3NDJEMzQyQkQyRkRGMTMyNTk4MTc3RTk1MTI5MkM0RDIyOUQ5N0I5Njk3MzU2RDAzNkUwNTI3RDM2MTk1NURDN0Y0RTZDODU3RkJEOTNCRjQwQ0NEOTE3Qzk2RkM0NzZGOEZFQ0RCQTc1OThBNEE0REZGRUI2QkVCNTU0OUE4REZBRjA0NDg0RUU5MTcyNkE3QzlFNkEwNjA4QTM5QTA5Q0E4NTM2M0NBQTQzRDE4MjBGM0I2QjNEQzUxMDg0MjQ2QThCMRKABEJCOEUzNzRBOEYxNzk3M0UxMzE1M0NBMDUwQTA3QUU3ODZBNTI4MDgwRUYyQ0IwRTUwN0ZEOTFEMUNEMzQwNDE5RjBGQzJEQTE1NDQ5MjE4Mzc0MjBFNTRDMTAwNTRDMjBERDQ1QkZDQ0REMDk0REFDODlCQzVBQUY3RjhFRUQyRDI4QzA4MkQyNDhBNDg3QTgyMDQ2NTM4RDgxQUZDRkZFRURFMjU2MkIxRjBEQTU3QkM4NTIxNTIzNzNDMTMzQjE5NkQxOEU5OEYzRDZGQzkzRTRFQzE0REJDMjc0Q0IwRkNBMTRFMEI3RDhEMzBCM0E3OTYxMUIzMThEMERDMDNERjlCNTFGRkIyMzdEN0VGOEU2RTJFNDU5ODIyRjVERUZCNjI4NzAzMDgyNEUyNTkwQUQ2RkJBNEJERTc0MkQzNDJCRDJGREYxMzI1OTgxNzdFOTUxMjkyQzREMjI5RDk3Qjk2OTczNTZEMDM2RTA1MjdEMzYxOTU1REM3RjRFNkM4NTdGQkQ5M0JGNDBDQ0Q5MTdDOTZGQzQ3NkY4RkVDREJBNzU5OEE0QTRERkZFQjZCRUI1NTQ5QThERkFGMDQ0ODRFRTkxNzI2QTdDOUU2QTA2MDhBMzlBMDlDQTg1MzYzQ0FBNDNEMTgyMEYzQjZCM0RDNTEwODQyNDZBOEIyIoAIMUM1NEZEMTU2MTgyMUREODdCQjkxNkYyQzYwMjc4OUU0QkM3NUU4RDAzQkVGRjhERDgzREQyOTFEMzczQThDNTEyQTAzMkMxMjI2RjYxRTkwRTBDMzkxQUYzMjQyMEZDMkUzMjEyNzJFQjRDNzA5NUM4RjgzQTEzMEUzMTQ0NTc3ODU5MjkwNEVGMEMwOTM5Q0JBRjNBODMyOUVBQUEzNURFNEU1MTRBMzkyQTRBQ0VFMzg4RUI1RTI5OEVFMDEyQTVDMzczRTgzOUVEOEM4REVDRUU5MDU2MkQ2QjczNjlCQzc0QTNBREYxMTE0NjMyQkQ4MzIzQkUzREVCNkI3MzU0MjJFMUI4NzcyQ0VBMThBQjQzNjcyNUEwREI2RUUyQjMwQTlCNkUxNEVCNjdBNUZBQTY0N0Y1RTlCNzVBQTFGQjU5NENEMDE0NjNDNzk3RjJGMTE0NUU1NEVGODFEMzUxMjg0MEIwMzBFNEYxMzVDMTBBRTgxMkNGMDFEMTA0QkE3MEJFRTdFRkU3QTRFMzZENjkwMTc1OTQ2M0FDNUM4MTFCRjc4MzJEQUE3QUQyNUE5MjlDODczMTI0REREODQwRDlBRDA5NjVGNjc0ODVERjNDOERBMTQyMzQ1Q0YzRjQzRTg4RjZGREU0NzNCQzQ0MEFCQ0JBMTNDQTdCQzM3NzJGMUExMUNCQjZBOTU5MjcxN0I4RDJFQzBCQzcyOTA1NUY4NTMxRUFENjk2RTVFQkU4RDRGODg5QjI4N0M3NDFGQTZCNTQ2QzQ5OUZCODQzQUVERTFEQ0U0QjVCMjQ0NkM5OTRBQkM0QzA2MDZEM0VBNzM3M0FENTA5MUQzRjg4OTlEMjlCNEJEMDRGRkRFQTNCRUU3OTEyMEY3QUEzMERCNjBENTYzNDdBNDIyNTcxMzIyNkUwNkZDRThEREE0NUU1MzIzNTY4OUE5MjQwOTIxOEQxNzJDNzg5N0FFNDQ0RDZDRDU2NUFFRTg5RTgwRjc5NUUwNkU0M0Y3QkMxQ0EzODhBMzI0QzU2NjFDRThCREFCRkVGMUM3MEZBRDM5QjYxOEY3MkI2RTIwQTVGQjZCRDUwRkQ3NDA3MjQyQTlDRkNFNzJCQzg2RkQyRkI5QTczN0E1NERFNzZGQzc0NUYxQjc4REY2QjUzNzA5REQ0QzVEMzlCQjI4MDYwMDQyOTAzNjA4MTk3MkUzQzMzMDM5RDhBMUQ0NzRCMjQzN0Q4RjE4QjcyQTMzOTgwRDhBNzE5RTQxNTVEQzM4NkNGMDkzMTNFN0UxQTJFMTA5MkQ5MzRBNzExM0FCMDFDMDkwQjVGRjNGQTRFNzU2MTMxNENCQzI3NzBDNjkxMTkyRQ..";

    P1Context p1_context;
    P2Context p2_context;
    p1_context.CreateContext(safeheron::curve::CurveType::SECP256K1, key_share1_b64, m);
    p2_context.CreateContext(safeheron::curve::CurveType::SECP256K1, key_share2_b64, m);

    bool ok = true;
    std::string p1_message0;
    ok = p1_context.Step0(p1_message0);
    EXPECT_TRUE(ok);
    std::string p2_message0;
    ok = p2_context.Step0(p1_message0, p2_message0);
    EXPECT_TRUE(ok);

    std::string p1_message1;
    ok = p1_context.Step1(p2_message0, p1_message1);
    EXPECT_TRUE(ok);
    std::string p2_message1;
    ok = p2_context.Step1(p1_message1, p2_message1);
    EXPECT_TRUE(ok);

    std::string p1_message2;
    ok = p1_context.Step2(p2_message1, p1_message2);
    EXPECT_TRUE(ok);
    std::string p2_message2;
    ok = p2_context.Step2(p1_message2, p2_message2);
    EXPECT_TRUE(ok);

    ok = p1_context.Step3(p2_message2);
    EXPECT_TRUE(ok);

    uint8_t sig64[64];
    uint32_t v;

    ok = p1_context.export_sig(sig64, v);
    EXPECT_TRUE(ok);
    std::cout << "sig: " << safeheron::encode::hex::EncodeToHex(sig64, 64) << std::endl;
    std::cout << "v: " << v << std::endl;
}

int main(int argc, char **argv) {
    ::testing::InitGoogleTest(&argc, argv);
    int ret = RUN_ALL_TESTS();
    return ret;
}